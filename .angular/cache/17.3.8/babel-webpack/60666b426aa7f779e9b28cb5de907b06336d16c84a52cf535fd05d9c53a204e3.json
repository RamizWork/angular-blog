{"ast":null,"code":"import { UntypedFormControl, UntypedFormGroup, Validators } from \"@angular/forms\";\nimport { MAT_LEGACY_DIALOG_DATA as MAT_DIALOG_DATA } from \"@angular/material/legacy-dialog\";\nimport { switchMap, tap } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../shared/services/user.service\";\nimport * as i2 from \"@angular/material/legacy-dialog\";\nimport * as i3 from \"../../shared/services/fireBase.service\";\nimport * as i4 from \"@angular/forms\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/legacy-button\";\nconst _c0 = [\"fileUpload\"];\nconst _c1 = a0 => ({\n  invalid: a0\n});\nfunction UserProfileModalComponent_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"small\", 17);\n    i0.ɵɵtext(2, \"Full name not be empty\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction UserProfileModalComponent_ng_container_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainer(0);\n  }\n}\nexport class UserProfileModalComponent {\n  constructor(userService, dialog, fireBaseService, data) {\n    this.userService = userService;\n    this.dialog = dialog;\n    this.fireBaseService = fireBaseService;\n    this.data = data;\n    this.isDisabled = false;\n  }\n  ngOnInit() {\n    this.initializeForm();\n  }\n  initializeForm() {\n    const photoUrl = this.data.photoUrl ? this.data.photoUrl : 'assets/user_icon.png';\n    this.form = new UntypedFormGroup({\n      fullName: new UntypedFormControl(this.data.displayName, Validators.required),\n      userPhoto: new UntypedFormControl(''),\n      avatarFile: new UntypedFormControl()\n    });\n    this.form.patchValue({\n      userPhoto: photoUrl\n    });\n  }\n  editPhoto() {\n    const fileUpload = this.fileUpload?.nativeElement;\n    fileUpload.onchange = () => {\n      const file = fileUpload.files[0];\n      const reader = new FileReader();\n      if (file) {\n        reader.readAsDataURL(file);\n      }\n      reader.onload = () => {\n        const img = new Image();\n        img.src = reader.result;\n        img.onload = () => {\n          this.form.patchValue({\n            userPhoto: reader.result,\n            avatarFile: file\n          });\n        };\n      };\n    };\n  }\n  modalClose() {\n    this.dialog.closeAll();\n  }\n  submit() {\n    if (this.form.invalid) {\n      this.isDisabled = true;\n    }\n    const userInfo = {\n      userPhoto: this.form.value.avatarFile,\n      fullName: this.form.value.fullName,\n      photoUrl: this.form.value.photoUrl\n    };\n    if (userInfo.userPhoto) {\n      this.userProfile$ = this.fireBaseService.upLoadFileToStorage(userInfo.userPhoto).pipe(switchMap(photoUrl => {\n        return this.userService.updateProfile(photoUrl, this.form.value.fullName);\n      }), tap(() => this.modalClose()));\n    } else {\n      this.userProfile$ = this.userService.updateProfile(userInfo.photoUrl, this.form.value.fullName).pipe(tap(() => this.modalClose()));\n    }\n  }\n  static #_ = this.ɵfac = function UserProfileModalComponent_Factory(t) {\n    return new (t || UserProfileModalComponent)(i0.ɵɵdirectiveInject(i1.UserService), i0.ɵɵdirectiveInject(i2.MatLegacyDialog), i0.ɵɵdirectiveInject(i3.FireBaseService), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserProfileModalComponent,\n    selectors: [[\"app-user-profile-modal\"]],\n    viewQuery: function UserProfileModalComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.fileUpload = _t.first);\n      }\n    },\n    decls: 23,\n    vars: 10,\n    consts: [[\"fileUpload\", \"\"], [\"mat-dialog-title\", \"\", 1, \"edit__profile_title\"], [\"mat-dialog-content\", \"\"], [\"action\", \"\", 3, \"ngSubmit\", \"formGroup\"], [1, \"content__wrapper\"], [1, \"user__photo\"], [\"for\", \"avatarInput\", 1, \"edit__photo\", 3, \"click\"], [\"src\", \"assets/camera.svg\", \"alt\", \"Edit photo\", 1, \"photo\"], [\"id\", \"avatarInput\", \"type\", \"file\", \"accept\", \"image/jpeg, image/png\", 1, \"avatarInput\"], [\"alt\", \"\", 1, \"photo\", 3, \"src\"], [1, \"display__name\"], [\"for\", \"fullName\"], [\"id\", \"fullName\", \"type\", \"text\", \"formControlName\", \"fullName\", 1, \"full__name_input\"], [4, \"ngIf\"], [1, \"btns\"], [\"mat-raised-button\", \"\", \"mat-button\", \"\", \"mat-dialog-close\", \"\", 1, \"btn__close\", 3, \"click\"], [\"mat-raised-button\", \"\", \"mat-button\", \"\", \"type\", \"submit\", 1, \"btn__update\", 3, \"ngClass\", \"disabled\"], [2, \"color\", \"red\"]],\n    template: function UserProfileModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r1 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"h1\", 1);\n        i0.ɵɵtext(1, \"Edit profile\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"form\", 3);\n        i0.ɵɵlistener(\"ngSubmit\", function UserProfileModalComponent_Template_form_ngSubmit_3_listener() {\n          i0.ɵɵrestoreView(_r1);\n          return i0.ɵɵresetView(ctx.submit());\n        });\n        i0.ɵɵelementStart(4, \"div\", 4)(5, \"div\", 5)(6, \"label\", 6);\n        i0.ɵɵlistener(\"click\", function UserProfileModalComponent_Template_label_click_6_listener() {\n          i0.ɵɵrestoreView(_r1);\n          return i0.ɵɵresetView(ctx.editPhoto());\n        });\n        i0.ɵɵelement(7, \"img\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(8, \"input\", 8, 0)(10, \"img\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\", 10)(12, \"label\", 11);\n        i0.ɵɵtext(13, \"Full name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(14, \"input\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(15, UserProfileModalComponent_div_15_Template, 3, 0, \"div\", 13);\n        i0.ɵɵelementStart(16, \"div\", 14)(17, \"button\", 15);\n        i0.ɵɵlistener(\"click\", function UserProfileModalComponent_Template_button_click_17_listener() {\n          i0.ɵɵrestoreView(_r1);\n          return i0.ɵɵresetView(ctx.modalClose());\n        });\n        i0.ɵɵtext(18, \"Cancel\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"button\", 16);\n        i0.ɵɵtext(20, \"Update \");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵtemplate(21, UserProfileModalComponent_ng_container_21_Template, 1, 0, \"ng-container\", 13);\n        i0.ɵɵpipe(22, \"async\");\n      }\n      if (rf & 2) {\n        let tmp_3_0;\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"formGroup\", ctx.form);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"src\", ctx.form.value.userPhoto, i0.ɵɵsanitizeUrl);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"fullName\").touched && ((tmp_3_0 = ctx.form.get(\"fullName\").errors) == null ? null : tmp_3_0.required));\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c1, !!ctx.form.invalid || ctx.isDisabled))(\"disabled\", !!ctx.form.invalid);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(22, 6, ctx.userProfile$));\n      }\n    },\n    dependencies: [i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i5.NgClass, i5.NgIf, i4.FormGroupDirective, i4.FormControlName, i6.MatLegacyButton, i2.MatLegacyDialogClose, i2.MatLegacyDialogTitle, i2.MatLegacyDialogContent, i5.AsyncPipe],\n    styles: [\"h1[_ngcontent-%COMP%] {\\n  color: black;\\n}\\n\\n.content__wrapper[_ngcontent-%COMP%] {\\n  width: 320px;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: space-between;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .btn__close[_ngcontent-%COMP%] {\\n  margin-right: 15px;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .btn__update[_ngcontent-%COMP%] {\\n  background-color: #4351a9;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .btn__update[_ngcontent-%COMP%]:disabled {\\n  color: white;\\n  background-color: #bdbdbd;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .invalid[_ngcontent-%COMP%] {\\n  background-color: grey;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%] {\\n  display: flex;\\n  justify-content: flex-end;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .display__name[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  margin-bottom: 16px;\\n  color: black;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .display__name[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {\\n  all: unset;\\n  border: none;\\n  background-color: white;\\n  border-bottom: 2px solid black;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .display__name[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus {\\n  border: none;\\n  background-color: white;\\n  border-bottom: 2px solid black;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .user__photo[_ngcontent-%COMP%] {\\n  position: relative;\\n  width: 160px;\\n  height: 160px;\\n  background-color: #888888;\\n  border-radius: 50%;\\n  margin-bottom: 15px;\\n  overflow: hidden;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .user__photo[_ngcontent-%COMP%]   .avatarInput[_ngcontent-%COMP%] {\\n  display: none;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .user__photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%] {\\n  object-fit: cover;\\n  height: 100%;\\n  width: 100%;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .edit__photo[_ngcontent-%COMP%] {\\n  cursor: pointer;\\n  display: flex;\\n  overflow: hidden;\\n  bottom: 9px;\\n  align-items: center;\\n  right: 36px;\\n  height: 35px;\\n  width: 35px;\\n  position: absolute;\\n  background-color: white;\\n  border-radius: 50%;\\n}\\n.content__wrapper[_ngcontent-%COMP%]   .edit__photo[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%] {\\n  object-fit: fill;\\n  height: 20px;\\n  width: 100%;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvYWRtaW4vdXNlci1wcm9maWxlL3VzZXItcHJvZmlsZS1tb2RhbC91c2VyLXByb2ZpbGUtbW9kYWwuY29tcG9uZW50LnNjc3MiLCJ3ZWJwYWNrOi8vLi8uLi8uLi9Qcm9nZWN0JTIwZm9yJTIwbGVhcm5pbmcvYW5ndWxhci1ibG9nL3NyYy9hcHAvYWRtaW4vdXNlci1wcm9maWxlL3VzZXItcHJvZmlsZS1tb2RhbC91c2VyLXByb2ZpbGUtbW9kYWwuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxZQUFBO0FDQ0Y7O0FER0E7RUFDRSxZQUFBO0VBQ0EsYUFBQTtFQUNBLHNCQUFBO0VBQ0EsOEJBQUE7QUNBRjtBREVFO0VBQ0Usa0JBQUE7QUNBSjtBREVFO0VBQ0UseUJBQUE7QUNBSjtBRENJO0VBQ0UsWUFBQTtFQUNBLHlCQUFBO0FDQ047QURFRTtFQUNFLHNCQUFBO0FDQUo7QURHRTtFQUNFLGFBQUE7RUFDQSx5QkFBQTtBQ0RKO0FESUU7RUFDRSxhQUFBO0VBQ0Esc0JBQUE7RUFDQSx1QkFBQTtFQUNBLG1CQUFBO0VBQ0EsWUFBQTtBQ0ZKO0FES0k7RUFDRSxVQUFBO0VBQ0EsWUFBQTtFQUNBLHVCQUFBO0VBQ0EsOEJBQUE7QUNITjtBREtNO0VBQ0UsWUFBQTtFQUNBLHVCQUFBO0VBQ0EsOEJBQUE7QUNIUjtBRFFFO0VBQ0Usa0JBQUE7RUFDQSxZQUFBO0VBQ0EsYUFBQTtFQUNBLHlCQUFBO0VBQ0Esa0JBQUE7RUFDQSxtQkFBQTtFQUNBLGdCQUFBO0FDTko7QURRSTtFQUNFLGFBQUE7QUNOTjtBRFNJO0VBQ0UsaUJBQUE7RUFDQSxZQUFBO0VBQ0EsV0FBQTtBQ1BOO0FEV0U7RUFDRSxlQUFBO0VBQ0EsYUFBQTtFQUNBLGdCQUFBO0VBQ0EsV0FBQTtFQUNBLG1CQUFBO0VBQ0EsV0FBQTtFQUNBLFlBQUE7RUFDQSxXQUFBO0VBQ0Esa0JBQUE7RUFDQSx1QkFBQTtFQUNBLGtCQUFBO0FDVEo7QURXSTtFQUNFLGdCQUFBO0VBQ0EsWUFBQTtFQUNBLFdBQUE7QUNUTiIsInNvdXJjZXNDb250ZW50IjpbImgxIHtcclxuICBjb2xvcjogYmxhY2s7XHJcbn1cclxuXHJcblxyXG4uY29udGVudF9fd3JhcHBlciB7XHJcbiAgd2lkdGg6IDMyMHB4O1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XHJcblxyXG4gIC5idG5fX2Nsb3NlIHtcclxuICAgIG1hcmdpbi1yaWdodDogMTVweDtcclxuICB9XHJcbiAgLmJ0bl9fdXBkYXRle1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzQzNTFhOTtcclxuICAgICY6ZGlzYWJsZWQge1xyXG4gICAgICBjb2xvcjogd2hpdGU7XHJcbiAgICAgIGJhY2tncm91bmQtY29sb3I6ICNiZGJkYmQ7XHJcbiAgICB9XHJcbiAgfVxyXG4gIC5pbnZhbGlkIHtcclxuICAgIGJhY2tncm91bmQtY29sb3I6IGdyZXk7XHJcbiAgfVxyXG5cclxuICAuYnRucyB7XHJcbiAgICBkaXNwbGF5OiBmbGV4O1xyXG4gICAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDtcclxuICB9XHJcblxyXG4gIC5kaXNwbGF5X19uYW1lIHtcclxuICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xyXG4gICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XHJcbiAgICBtYXJnaW4tYm90dG9tOiAxNnB4O1xyXG4gICAgY29sb3I6IGJsYWNrO1xyXG5cclxuXHJcbiAgICBpbnB1dCB7XHJcbiAgICAgIGFsbDogdW5zZXQ7XHJcbiAgICAgIGJvcmRlcjogbm9uZTtcclxuICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XHJcbiAgICAgIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCBibGFjaztcclxuXHJcbiAgICAgICY6Zm9jdXMge1xyXG4gICAgICAgIGJvcmRlcjogbm9uZTtcclxuICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTtcclxuICAgICAgICBib3JkZXItYm90dG9tOiAycHggc29saWQgYmxhY2s7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC51c2VyX19waG90byB7XHJcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XHJcbiAgICB3aWR0aDogMTYwcHg7XHJcbiAgICBoZWlnaHQ6IDE2MHB4O1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzg4ODg4ODtcclxuICAgIGJvcmRlci1yYWRpdXM6IDUwJTtcclxuICAgIG1hcmdpbi1ib3R0b206IDE1cHg7XHJcbiAgICBvdmVyZmxvdzogaGlkZGVuO1xyXG5cclxuICAgIC5hdmF0YXJJbnB1dCB7XHJcbiAgICAgIGRpc3BsYXk6IG5vbmU7XHJcbiAgICB9XHJcblxyXG4gICAgLnBob3RvIHtcclxuICAgICAgb2JqZWN0LWZpdDogY292ZXI7XHJcbiAgICAgIGhlaWdodDogMTAwJTtcclxuICAgICAgd2lkdGg6IDEwMCU7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAuZWRpdF9fcGhvdG8ge1xyXG4gICAgY3Vyc29yOiBwb2ludGVyO1xyXG4gICAgZGlzcGxheTogZmxleDtcclxuICAgIG92ZXJmbG93OiBoaWRkZW47XHJcbiAgICBib3R0b206IDlweDtcclxuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgICByaWdodDogMzZweDtcclxuICAgIGhlaWdodDogMzVweDtcclxuICAgIHdpZHRoOiAzNXB4O1xyXG4gICAgcG9zaXRpb246IGFic29sdXRlO1xyXG4gICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XHJcbiAgICBib3JkZXItcmFkaXVzOiA1MCU7XHJcblxyXG4gICAgLnBob3RvIHtcclxuICAgICAgb2JqZWN0LWZpdDogZmlsbDtcclxuICAgICAgaGVpZ2h0OiAyMHB4O1xyXG4gICAgICB3aWR0aDogMTAwJTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbiIsImgxIHtcbiAgY29sb3I6IGJsYWNrO1xufVxuXG4uY29udGVudF9fd3JhcHBlciB7XG4gIHdpZHRoOiAzMjBweDtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmJ0bl9fY2xvc2Uge1xuICBtYXJnaW4tcmlnaHQ6IDE1cHg7XG59XG4uY29udGVudF9fd3JhcHBlciAuYnRuX191cGRhdGUge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjNDM1MWE5O1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmJ0bl9fdXBkYXRlOmRpc2FibGVkIHtcbiAgY29sb3I6IHdoaXRlO1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjYmRiZGJkO1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmludmFsaWQge1xuICBiYWNrZ3JvdW5kLWNvbG9yOiBncmV5O1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmJ0bnMge1xuICBkaXNwbGF5OiBmbGV4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGZsZXgtZW5kO1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmRpc3BsYXlfX25hbWUge1xuICBkaXNwbGF5OiBmbGV4O1xuICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgbWFyZ2luLWJvdHRvbTogMTZweDtcbiAgY29sb3I6IGJsYWNrO1xufVxuLmNvbnRlbnRfX3dyYXBwZXIgLmRpc3BsYXlfX25hbWUgaW5wdXQge1xuICBhbGw6IHVuc2V0O1xuICBib3JkZXI6IG5vbmU7XG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICBib3JkZXItYm90dG9tOiAycHggc29saWQgYmxhY2s7XG59XG4uY29udGVudF9fd3JhcHBlciAuZGlzcGxheV9fbmFtZSBpbnB1dDpmb2N1cyB7XG4gIGJvcmRlcjogbm9uZTtcbiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7XG4gIGJvcmRlci1ib3R0b206IDJweCBzb2xpZCBibGFjaztcbn1cbi5jb250ZW50X193cmFwcGVyIC51c2VyX19waG90byB7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDE2MHB4O1xuICBoZWlnaHQ6IDE2MHB4O1xuICBiYWNrZ3JvdW5kLWNvbG9yOiAjODg4ODg4O1xuICBib3JkZXItcmFkaXVzOiA1MCU7XG4gIG1hcmdpbi1ib3R0b206IDE1cHg7XG4gIG92ZXJmbG93OiBoaWRkZW47XG59XG4uY29udGVudF9fd3JhcHBlciAudXNlcl9fcGhvdG8gLmF2YXRhcklucHV0IHtcbiAgZGlzcGxheTogbm9uZTtcbn1cbi5jb250ZW50X193cmFwcGVyIC51c2VyX19waG90byAucGhvdG8ge1xuICBvYmplY3QtZml0OiBjb3ZlcjtcbiAgaGVpZ2h0OiAxMDAlO1xuICB3aWR0aDogMTAwJTtcbn1cbi5jb250ZW50X193cmFwcGVyIC5lZGl0X19waG90byB7XG4gIGN1cnNvcjogcG9pbnRlcjtcbiAgZGlzcGxheTogZmxleDtcbiAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgYm90dG9tOiA5cHg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIHJpZ2h0OiAzNnB4O1xuICBoZWlnaHQ6IDM1cHg7XG4gIHdpZHRoOiAzNXB4O1xuICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gIGJhY2tncm91bmQtY29sb3I6IHdoaXRlO1xuICBib3JkZXItcmFkaXVzOiA1MCU7XG59XG4uY29udGVudF9fd3JhcHBlciAuZWRpdF9fcGhvdG8gLnBob3RvIHtcbiAgb2JqZWN0LWZpdDogZmlsbDtcbiAgaGVpZ2h0OiAyMHB4O1xuICB3aWR0aDogMTAwJTtcbn0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n  });\n}","map":{"version":3,"names":["UntypedFormControl","UntypedFormGroup","Validators","MAT_LEGACY_DIALOG_DATA","MAT_DIALOG_DATA","switchMap","tap","i0","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵelementContainer","UserProfileModalComponent","constructor","userService","dialog","fireBaseService","data","isDisabled","ngOnInit","initializeForm","photoUrl","form","fullName","displayName","required","userPhoto","avatarFile","patchValue","editPhoto","fileUpload","nativeElement","onchange","file","files","reader","FileReader","readAsDataURL","onload","img","Image","src","result","modalClose","closeAll","submit","invalid","userInfo","value","userProfile$","upLoadFileToStorage","pipe","updateProfile","_","ɵɵdirectiveInject","i1","UserService","i2","MatLegacyDialog","i3","FireBaseService","_2","selectors","viewQuery","UserProfileModalComponent_Query","rf","ctx","ɵɵlistener","UserProfileModalComponent_Template_form_ngSubmit_3_listener","ɵɵrestoreView","_r1","ɵɵresetView","UserProfileModalComponent_Template_label_click_6_listener","ɵɵelement","ɵɵtemplate","UserProfileModalComponent_div_15_Template","UserProfileModalComponent_Template_button_click_17_listener","UserProfileModalComponent_ng_container_21_Template","ɵɵadvance","ɵɵproperty","ɵɵsanitizeUrl","get","touched","tmp_3_0","errors","ɵɵpureFunction1","_c1","ɵɵpipeBind1"],"sources":["C:\\Progect for learning\\angular-blog\\src\\app\\admin\\user-profile\\user-profile-modal\\user-profile-modal.component.ts","C:\\Progect for learning\\angular-blog\\src\\app\\admin\\user-profile\\user-profile-modal\\user-profile-modal.component.html"],"sourcesContent":["import {Component, ElementRef, Inject, OnInit, ViewChild} from '@angular/core';\r\nimport {UntypedFormControl, UntypedFormGroup, Validators} from \"@angular/forms\";\r\nimport {MAT_LEGACY_DIALOG_DATA as MAT_DIALOG_DATA, MatLegacyDialog as MatDialog} from \"@angular/material/legacy-dialog\";\r\nimport {Observable} from \"rxjs\";\r\nimport {switchMap, tap} from \"rxjs/operators\";\r\n\r\nimport {UserService} from \"../../shared/services/user.service\";\r\nimport {ResponseEditProfileInterface} from \"../../shared/interfaces/responseEditProfile.interface\";\r\nimport {FireBaseService} from \"../../shared/services/fireBase.service\";\r\n\r\n@Component({\r\n  selector: 'app-user-profile-modal',\r\n  templateUrl: './user-profile-modal.component.html',\r\n  styleUrls: ['./user-profile-modal.component.scss']\r\n})\r\nexport class UserProfileModalComponent implements OnInit {\r\n  @ViewChild('fileUpload') fileUpload: ElementRef | undefined;\r\n  userProfile$: Observable<ResponseEditProfileInterface> | undefined;\r\n  form: UntypedFormGroup | any;\r\n  isDisabled: boolean = false;\r\n\r\n  constructor(\r\n    private userService: UserService,\r\n    private dialog: MatDialog,\r\n    private fireBaseService: FireBaseService,\r\n    @Inject(MAT_DIALOG_DATA) public data: { userEmail: string, displayName: string, photoUrl: string }\r\n  ) {\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.initializeForm();\r\n  }\r\n\r\n  private initializeForm() {\r\n    const photoUrl = this.data.photoUrl ? this.data.photoUrl : 'assets/user_icon.png';\r\n\r\n    this.form = new UntypedFormGroup({\r\n      fullName: new UntypedFormControl(this.data.displayName, Validators.required),\r\n      userPhoto: new UntypedFormControl(''),\r\n      avatarFile: new UntypedFormControl()\r\n    })\r\n    this.form.patchValue({userPhoto: photoUrl});\r\n  }\r\n\r\n  editPhoto() {\r\n    const fileUpload = this.fileUpload?.nativeElement;\r\n\r\n    fileUpload.onchange = () => {\r\n      const file = fileUpload.files[0];\r\n      const reader = new FileReader();\r\n\r\n      if (file) {\r\n        reader.readAsDataURL(file);\r\n      }\r\n\r\n      reader.onload = () => {\r\n        const img = new Image();\r\n\r\n        img.src = reader.result as string;\r\n        img.onload = () => {\r\n          this.form.patchValue({\r\n            userPhoto: reader.result,\r\n            avatarFile: file\r\n          })\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  modalClose() {\r\n    this.dialog.closeAll();\r\n  }\r\n\r\n  submit() {\r\n    if (this.form.invalid) {\r\n      this.isDisabled = true;\r\n    }\r\n    const userInfo = {\r\n      userPhoto: this.form.value.avatarFile,\r\n      fullName: this.form.value.fullName,\r\n      photoUrl: this.form.value.photoUrl\r\n    }\r\n\r\n    if (userInfo.userPhoto) {\r\n      this.userProfile$ = this.fireBaseService.upLoadFileToStorage(userInfo.userPhoto).pipe(\r\n        switchMap((photoUrl) => {\r\n          return this.userService.updateProfile(photoUrl, this.form.value.fullName);\r\n        }),\r\n        tap(() => this.modalClose())\r\n      );\r\n    } else {\r\n      this.userProfile$ = this.userService.updateProfile(userInfo.photoUrl, this.form.value.fullName)\r\n        .pipe(\r\n          tap(() => this.modalClose())\r\n        );\r\n    }\r\n  }\r\n\r\n}\r\n","<h1 class=\"edit__profile_title\" mat-dialog-title>Edit profile</h1>\r\n<div mat-dialog-content>\r\n  <form action=\"\" [formGroup]=\"form\" (ngSubmit)=\"submit()\">\r\n    <div class=\"content__wrapper\">\r\n\r\n      <div class=\"user__photo\">\r\n        <label for=\"avatarInput\" class=\"edit__photo\" (click)=\"editPhoto()\">\r\n          <img class=\"photo\" src=\"assets/camera.svg\" alt=\"Edit photo\">\r\n        </label>\r\n\r\n        <input class=\"avatarInput\"\r\n               id=\"avatarInput\"\r\n               type=\"file\"\r\n               accept=\"image/jpeg, image/png\"\r\n               #fileUpload>\r\n        <img class=\"photo\" [src]=\"form.value.userPhoto\" alt=\"\">\r\n      </div>\r\n\r\n      <div class=\"display__name\">\r\n        <label for=\"fullName\">Full name</label>\r\n        <input class=\"full__name_input\" id=\"fullName\" type=\"text\" formControlName=\"fullName\">\r\n      </div>\r\n\r\n      <div *ngIf=\"form.get('fullName').touched && form.get('fullName').errors?.required\">\r\n        <small style=\"color: red\">Full name not be empty</small>\r\n      </div>\r\n\r\n      <div class=\"btns\">\r\n        <button class=\"btn__close\" mat-raised-button mat-button mat-dialog-close (click)=\"modalClose()\">Cancel</button>\r\n        <button\r\n          [ngClass]=\"{invalid: !!form.invalid || isDisabled}\"\r\n          class=\"btn__update\"\r\n          mat-raised-button\r\n          mat-button type=\"submit\"\r\n          [disabled]=\"!!form.invalid\">Update\r\n        </button>\r\n      </div>\r\n\r\n    </div>\r\n  </form>\r\n</div>\r\n\r\n<ng-container *ngIf=\"userProfile$ | async\"></ng-container>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}