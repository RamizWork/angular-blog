{"ast":null,"code":"import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spreadArray, __read, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar name = \"@firebase/installations\";\nvar version = \"0.4.32\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar _a;\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.', _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.', _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\" /* REQUEST_FAILED */);\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2 /* COMPLETED */,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, response.json()];\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, fn()];\n        case 1:\n          result = _a.sent();\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2 /*return*/, fn()];\n          }\n          return [2 /*return*/, result];\n      }\n    });\n  });\n}\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, response.json()];\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2 /* COMPLETED */,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2 /*return*/, registeredInstallationEntry];\n        case 3:\n          return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** Returns a promise that resolves after given time passes. */\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spreadArray([], __read(array))));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray);\n    // Replace the first 4 random bits with the constant FID header of 0b0111.\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray);\n  // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n  return b64String.substr(0, 22);\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/** Returns a string key that can be used to identify the app. */\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar fidChangeCallbacks = new Map();\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\nfunction fidChanged(appConfig, fid) {\n  var key = getKey(appConfig);\n  callFidChangeCallbacks(key, fid);\n  broadcastFidChange(key, fid);\n}\nfunction addCallback(appConfig, callback) {\n  // Open the broadcast channel if it's not already open,\n  // to be able to listen to change events from other tabs.\n  getBroadcastChannel();\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n  if (!callbackSet) {\n    callbackSet = new Set();\n    fidChangeCallbacks.set(key, callbackSet);\n  }\n  callbackSet.add(callback);\n}\nfunction removeCallback(appConfig, callback) {\n  var key = getKey(appConfig);\n  var callbackSet = fidChangeCallbacks.get(key);\n  if (!callbackSet) {\n    return;\n  }\n  callbackSet.delete(callback);\n  if (callbackSet.size === 0) {\n    fidChangeCallbacks.delete(key);\n  }\n  // Close broadcast channel if there are no more callbacks.\n  closeBroadcastChannel();\n}\nfunction callFidChangeCallbacks(key, fid) {\n  var e_1, _a;\n  var callbacks = fidChangeCallbacks.get(key);\n  if (!callbacks) {\n    return;\n  }\n  try {\n    for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\n      var callback = callbacks_1_1.value;\n      callback(fid);\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n}\nfunction broadcastFidChange(key, fid) {\n  var channel = getBroadcastChannel();\n  if (channel) {\n    channel.postMessage({\n      key: key,\n      fid: fid\n    });\n  }\n  closeBroadcastChannel();\n}\nvar broadcastChannel = null;\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\nfunction getBroadcastChannel() {\n  if (!broadcastChannel && 'BroadcastChannel' in self) {\n    broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\n    broadcastChannel.onmessage = function (e) {\n      callFidChangeCallbacks(e.data.key, e.data.fid);\n    };\n  }\n  return broadcastChannel;\n}\nfunction closeBroadcastChannel() {\n  if (fidChangeCallbacks.size === 0 && broadcastChannel) {\n    broadcastChannel.close();\n    broadcastChannel = null;\n  }\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, objectStore, oldValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          objectStore = tx.objectStore(OBJECT_STORE_NAME);\n          return [4 /*yield*/, objectStore.get(key)];\n        case 2:\n          oldValue = _a.sent();\n          return [4 /*yield*/, objectStore.put(value, key)];\n        case 3:\n          _a.sent();\n          return [4 /*yield*/, tx.complete];\n        case 4:\n          _a.sent();\n          if (!oldValue || oldValue.fid !== value.fid) {\n            fidChanged(appConfig, value.fid);\n          }\n          return [2 /*return*/, value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\n        case 2:\n          _a.sent();\n          return [4 /*yield*/, tx.complete];\n        case 3:\n          _a.sent();\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4 /*yield*/, getDbPromise()];\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4 /*yield*/, store.get(key)];\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3 /*break*/, 4];\n          return [4 /*yield*/, store.delete(key)];\n        case 3:\n          _a.sent();\n          return [3 /*break*/, 6];\n        case 4:\n          return [4 /*yield*/, store.put(newValue, key)];\n        case 5:\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          return [4 /*yield*/, tx.complete];\n        case 7:\n          _a.sent();\n          if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\n            fidChanged(appConfig, newValue.fid);\n          }\n          return [2 /*return*/, newValue];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry;\n    var _a;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\n          _a = {};\n          return [4 /*yield*/, registrationPromise];\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\n        case 3:\n          return [2 /*return*/, {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0 /* NOT_STARTED */\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\n    if (!navigator.onLine) {\n      // Registration required but app is offline.\n      var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: registrationPromiseWithError\n      };\n    }\n    // Try registering. Change status to IN_PROGRESS.\n    var inProgressEntry = {\n      fid: installationEntry.fid,\n      registrationStatus: 1 /* IN_PROGRESS */,\n      registrationTime: Date.now()\n    };\n    var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n    return {\n      installationEntry: inProgressEntry,\n      registrationPromise: registrationPromise\n    };\n  } else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\n    return {\n      installationEntry: installationEntry,\n      registrationPromise: waitUntilFidRegistration(appConfig)\n    };\n  } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n          return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          return [4 /*yield*/, remove(appConfig)];\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n          return [3 /*break*/, 6];\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4 /*yield*/, set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0 /* NOT_STARTED */\n          })];\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          throw e_1;\n        case 7:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, updateInstallationRequest(appConfig)];\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n        case 2:\n          if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\n          // createInstallation request still in progress.\n          return [4 /*yield*/, sleep(100)];\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n          return [4 /*yield*/, updateInstallationRequest(appConfig)];\n        case 4:\n          entry = _b.sent();\n          return [3 /*break*/, 2];\n        case 5:\n          if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\n          return [4 /*yield*/, getInstallationEntry(appConfig)];\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n          if (registrationPromise) {\n            return [2 /*return*/, registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2 /*return*/, installationEntry];\n          }\n        case 7:\n          return [2 /*return*/, entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\n    }\n    return clearTimedOutRequest(oldEntry);\n  });\n}\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0 /* NOT_STARTED */\n    };\n  }\n  return entry;\n}\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1 /* IN_PROGRESS */ && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n    platformLoggerProvider = _a.platformLoggerProvider;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, response.json()];\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2 /*return*/, completedAuthToken];\n        case 3:\n          return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\n            }\n            var oldAuthToken = oldEntry.authToken;\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\n              // There already is a token request in progress.\n              tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n              return oldEntry;\n            } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\n              }\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3 /*break*/, 3];\n          return [4 /*yield*/, tokenPromise];\n        case 2:\n          _a = _b.sent();\n          return [3 /*break*/, 4];\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n        case 4:\n          authToken = _a;\n          return [2 /*return*/, authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n        case 2:\n          if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\n          // generateAuthToken still in progress.\n          return [4 /*yield*/, sleep(100)];\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n          return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\n        case 4:\n          entry = _a.sent();\n          return [3 /*break*/, 2];\n        case 5:\n          authToken = entry.authToken;\n          if (authToken.requestStatus === 0 /* NOT_STARTED */) {\n            // The request timed out or failed in a different call. Try again.\n            return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\n          } else {\n            return [2 /*return*/, authToken];\n          }\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\n    }\n    var oldAuthToken = oldEntry.authToken;\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0 /* NOT_STARTED */\n        }\n      });\n    }\n    return oldEntry;\n  });\n}\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n          return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\n        case 2:\n          _a.sent();\n          return [2 /*return*/, authToken];\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          return [4 /*yield*/, remove(dependencies.appConfig)];\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n          return [3 /*break*/, 7];\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0 /* NOT_STARTED */\n            }\n          });\n          return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\n        case 6:\n          _a.sent();\n          _a.label = 7;\n        case 7:\n          throw e_1;\n        case 8:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2 /* COMPLETED */;\n}\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2 /* COMPLETED */ && !isAuthTokenExpired(authToken);\n}\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1 /* IN_PROGRESS */,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1 /* IN_PROGRESS */ && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction getId(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n          if (registrationPromise) {\n            registrationPromise.catch(console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies).catch(console.error);\n          }\n          return [2 /*return*/, installationEntry.fid];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\n        case 1:\n          _a.sent();\n          return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\n        case 2:\n          authToken = _a.sent();\n          return [2 /*return*/, authToken.token];\n      }\n    });\n  });\n}\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4 /*yield*/, getInstallationEntry(appConfig)];\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3 /*break*/, 3];\n          // A createInstallation request is in progress. Wait until it finishes.\n          return [4 /*yield*/, registrationPromise];\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n          _a.label = 3;\n        case 3:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4 /*yield*/, retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3 /*break*/, 3];\n          return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\n        case 2:\n          throw _a.sent();\n        case 3:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction deleteInstallation(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4 /*yield*/, update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\n              // Delete the unregistered entry without sending a deleteInstallation request.\n              return undefined;\n            }\n            return oldEntry;\n          })];\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3 /*break*/, 6];\n          if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\n          // Can't delete while trying to register.\n          throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\n        case 2:\n          if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\n          if (!!navigator.onLine) return [3 /*break*/, 3];\n          throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\n        case 3:\n          return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\n        case 4:\n          _a.sent();\n          return [4 /*yield*/, remove(appConfig)];\n        case 5:\n          _a.sent();\n          _a.label = 6;\n        case 6:\n          return [2 /*return*/];\n      }\n    });\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\nfunction onIdChange(_a, callback) {\n  var appConfig = _a.appConfig;\n  addCallback(appConfig, callback);\n  return function () {\n    removeCallback(appConfig, callback);\n  };\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction extractAppConfig(app) {\n  var e_1, _a;\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  }\n  // Required app config keys\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\n    valueName: valueName\n  });\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate();\n    // Throws if app isn't configured properly.\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    var installations = {\n      app: app,\n      getId: function () {\n        return getId(dependencies);\n      },\n      getToken: function (forceRefresh) {\n        return getToken(dependencies, forceRefresh);\n      },\n      delete: function () {\n        return deleteInstallation(dependencies);\n      },\n      onIdChange: function (callback) {\n        return onIdChange(dependencies, callback);\n      }\n    };\n    return installations;\n  }, \"PUBLIC\" /* PUBLIC */));\n  instance.registerVersion(name, version);\n}\nregisterInstallations(firebase);\nexport { registerInstallations };","map":{"version":3,"names":["firebase","Component","__awaiter","__generator","__spreadArray","__read","__values","__assign","ErrorFactory","FirebaseError","openDb","name","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","_a","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","error","code","includes","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","label","json","sent","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","Number","replace","createInstallationRequest","fid","endpoint","body","request","responseValue","registeredInstallationEntry","_b","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","getKey","appName","fidChangeCallbacks","Map","fidChanged","key","callFidChangeCallbacks","broadcastFidChange","addCallback","callback","getBroadcastChannel","callbackSet","get","Set","set","add","removeCallback","delete","size","closeBroadcastChannel","e_1","callbacks","callbacks_1","callbacks_1_1","next","done","value","e_1_1","return","call","channel","postMessage","broadcastChannel","BroadcastChannel","onmessage","e","data","close","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","objectStore","oldValue","transaction","put","complete","remove","update","updateFn","store","newValue","undefined","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","trys","push","customData","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","getImmediate","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","catch","console","getToken","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","onIdChange","extractAppConfig","app","options","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","valueName","registerInstallations","instance","installationsName","INTERNAL","registerComponent","container","getProvider","installations","registerVersion"],"sources":["C:/Progect for learning/angular-blog/node_modules/@firebase/installations/dist/index.esm.js"],"sourcesContent":["import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spreadArray, __read, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.32\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spreadArray([], __read(array))));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry;\r\n        var _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.customData.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) &&\r\n                        (e_1.customData.serverCode === 401 || e_1.customData.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}